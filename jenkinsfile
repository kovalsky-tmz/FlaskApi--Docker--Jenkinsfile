node{
    stage("Git SCM"){
        git credentialsId: 'dockerid', url: 'https://github.com/kowal20x7/FlaskApi-Jenkins-Docker.git'
    }
    stage("Build"){
        
    }
    stage("Test"){
        
    }
    stage("Build Docker Image"){
        sh "docker build -t kowal20x7/flaskapi:latest ."
    }
    stage ("Push dockerhub"){
        withCredentials([string(credentialsId: 'dockerpassid', variable: 'password')]) {
            sh "docker login -u kowal20x7 -p ${password}"
        }

        sh "docker push kowal20x7/flaskapi:latest"
    }
    
    stage("Run Container"){
        sh "docker run -d -p 5000:5000 --name flaskapi kowal20x7/flaskapi:latest"
    }
}
